<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1de9b6">
    <link rel="stylesheet" href="all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="dice2.css">
    <link rel="stylesheet" href="spinner.css">
    <title>Document</title>
</head>

<body>
    <div class="game">
        <div class="house green">
            <div class="box" id="green">
            </div>
        </div>

        <div class="house yellow" data-yindex="" style="right: 0">
            <div class="box" id="yellow" data-yindex="">
            </div>
        </div>

        <div class="house red" style="bottom: 0">
            <div class="box" id="red">
            </div>
        </div>

        <div class="house blue" style="bottom: 0;right: 0">
            <div class="box" id="blue">
            </div>
        </div>

        <div class="home"></div>
        <div class="cells" style="top: 40%;" data-index="51">

        </div>
        <div class="cells g-starts" style="top: 40%;left:6.66%;" data-index="0">
        </div>
        <div class="cells" style="top: 40%;left:13.32%;" data-index="1">

        </div>
        <div class="cells" style="top: 40%;left:19.98%;" data-index="2"></div>
        <div class="cells" style="top: 40%;left:26.64%;" data-index="3"></div>
        <div class="cells" style="top: 40%;left:33.3%;" data-index="4"></div>

        <div class="cells" style="top: 0;left:40%;" data-index="10"></div>
        <div class="cells" style="top: 6.66%;left:40%;" data-index="9"></div>
        <div class="cells " style="top: 13.32%;left:40%;" data-index="8"></div>
        <div class="cells" style="top: 19.98%;left:40%;" data-index="7"></div>
        <div class="cells" style="top: 26.64%;left:40%;" data-index="6"></div>
        <div class="cells" style="top: 33.3%;left:40%;" data-index="5"></div>

        <div class="cells" style="top: 0;left:46.66%;" data-index="11"></div>
        <div class="cells yellow houses" data-yindex="0" style="top: 6.66%;left:46.66%;"></div>
        <div class="cells yellow houses" data-yindex="1" style="top: 13.32%;left:46.66%;"></div>
        <div class="cells yellow houses" data-yindex="2" style="top: 19.98%;left:46.66%;"></div>
        <div class="cells yellow houses" data-yindex="3" style="top: 26.64%;left:46.66%;"></div>
        <div class="cells yellow houses" data-yindex="4" style="top: 33.3%;left:46.66%;"></div>

        <div class="cells" style="top: 0;left:53.32%;" data-index="12"></div>
        <div class="cells y-starts" style="top: 6.66%;left:53.32%;" data-index="13"></div>
        <div class="cells" style="top: 13.32%;left:53.32%;" data-index="14"></div>
        <div class="cells" style="top: 19.98%;left:53.32%;" data-index="15"></div>
        <div class="cells" style="top: 26.64%;left:53.32%;" data-index="16"></div>
        <div class="cells" style="top: 33.3%;left:53.32%;" data-index="17"></div>

        <div class="cells" style="top: 40%; right: 33.3%" data-index="18"></div>
        <div class="cells" style="top: 40%;right:26.64%;" data-index="19"></div>
        <div class="cells" style="top: 40%;right:19.98%;" data-index="20"></div>
        <div class="cells " style="top: 40%;right:13.32%;" data-index="21"></div>
        <div class="cells" style="top: 40%;right:6.66%;" data-index="22"></div>
        <div class="cells" style="top: 40%;right:0;" data-index="23"></div>

        <div class="cells blue houses" data-bindex="4" style="top: 46.66%; right: 33.3%"></div>
        <div class="cells blue houses" data-bindex="3" style="top: 46.66%;right:26.64%;"></div>
        <div class="cells blue houses" data-bindex="2" style="top: 46.66%;right:19.98%;"></div>
        <div class="cells blue houses" data-bindex="1" style="top: 46.66%;right:13.32%;"></div>
        <div class="cells blue houses" data-bindex="0" style="top: 46.66%;right:6.66%;"></div>
        <div class="cells" style="top: 46.66%;right:0;" data-index="24"></div>

        <div class="cells" style="top: 53.32%; right: 33.3%" data-index="30"></div>
        <div class="cells" style="top: 53.32%;right:26.64%;" data-index="29"></div>
        <div class="cells" style="top: 53.32%;right:19.98%;" data-index="28"></div>
        <div class="cells" style="top: 53.32%;right:13.32%;" data-index="27"></div>
        <div class="cells b-starts" style="top: 53.32%;right:6.66%;" data-index="26"></div>
        <div class="cells" style="top: 53.32%;right:0;" data-index="25"></div>

        <div class="cells" style="bottom: 0;left:53.32%;" data-index="36"></div>
        <div class="cells" style="bottom: 6.66%;left:53.32%;" data-index="35"></div>
        <div class="cells " style="bottom: 13.32%;left:53.32%;" data-index="34"></div>
        <div class="cells" style="bottom: 19.98%;left:53.32%;" data-index="33"></div>
        <div class="cells" style="bottom: 26.64%;left:53.32%;" data-index="32"></div>
        <div class="cells" style="bottom: 33.3%;left:53.32%;" data-index="31"></div>

        <div class="cells" style="bottom: 0;left:46.66%;" data-index="37"></div>
        <div class="cells red houses" data-rindex="0" style="bottom: 6.66%;left:46.66%;"></div>
        <div class="cells red houses" data-rindex="1" style="bottom: 13.32%;left:46.66%;"></div>
        <div class="cells red houses" data-rindex="2" style="bottom: 19.98%;left:46.66%;"></div>
        <div class="cells red houses" data-rindex="3" style="bottom: 26.64%;left:46.66%;"></div>
        <div class="cells red houses" data-rindex="4" style="bottom: 33.3%;left:46.66%;"></div>

        <div class="cells" style="bottom: 0;left:40%;" data-index="38"></div>
        <div class="cells r-starts" style="bottom: 6.66%;left:40%;" data-index="39"></div>
        <div class="cells" style="bottom: 13.32%;left:40%;" data-index="40"></div>
        <div class="cells" style="bottom: 19.98%;left:40%;" data-index="41"></div>
        <div class="cells" style="bottom: 26.64%;left:40%;" data-index="42"></div>
        <div class="cells" style="bottom: 33.3%;left:40%;" data-index="43"></div>

        <div class="cells" style="top: 53.32%; left: 33.3%" data-index="44"></div>
        <div class="cells" style="top: 53.32%;left:26.64%;" data-index="45"></div>
        <div class="cells" style="top: 53.32%;left:19.98%;" data-index="46"></div>
        <div class="cells " style="top: 53.32%;left:13.32%;" data-index="47"></div>
        <div class="cells" style="top: 53.32%;left:6.66%;" data-index="48"></div>
        <div class="cells" style="top: 53.32%;left:0;" data-index="49"></div>

        <div class="cells green houses" data-gindex="4" style="top: 46.66%;left: 33.3%"></div>
        <div class="cells green houses" data-gindex="3" style="top: 46.66%;left:26.64%;"></div>
        <div class="cells green houses" data-gindex="2" style="top: 46.66%;left:19.98%;"></div>
        <div class="cells green houses" data-gindex="1" style="top: 46.66%;left:13.32%;"></div>
        <div class="cells green houses" data-gindex="0" style="top: 46.66%;left:6.66%;"></div>
        <div class="cells" style="top: 46.66%;left:0;" data-index="50"></div>


    </div>

    <div class="dice">
        <ol class="die-list even-roll" data-roll="1" id="die-1">
            <li class="die-item" data-side="1">
                <span class="dot"></span>
            </li>
            <li class="die-item" data-side="2">
                <span class="dot"></span>
                <span class="dot"></span>
            </li>
            <li class="die-item" data-side="3">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </li>
            <li class="die-item" data-side="4">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </li>
            <li class="die-item" data-side="5">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </li>
            <li class="die-item" data-side="6">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </li>
        </ol>
        <ol class="die-list odd-roll" data-roll="1" id="die-2">
            <li class="die-item" data-side="1">
                <span class="dot"></span>
            </li>
            <li class="die-item" data-side="2">
                <span class="dot"></span>
                <span class="dot"></span>
            </li>
            <li class="die-item" data-side="3">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </li>
            <li class="die-item" data-side="4">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </li>
            <li class="die-item" data-side="5">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </li>
            <li class="die-item" data-side="6">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </li>
        </ol>
    </div>
    <div>
        <button id="count" onclick="emitCount()">Count seed</button>
        <button id="reset-count" onclick="">forfiet Count</button>
        <button id="quit">Exit Room</button>
        <button id="reset">Reset Game</button>

        <button type="button" id="roll-button" onclick="rollsDice()">Roll Dice</button>
        <p class="rolls one" onclick="emitSelectedRoll()">0</p>
        <p class="rolls two" onclick="emitSelectedRoll()">0</p>
    </div>
    <div style="margin: 20px 10px;" class="out-container" id="playerOne">

    </div>
    <div style="margin: 20px 10px;" class="out-container" id="playerTwo">

    </div>
    <div id="spinner-container">
        <p id="toast">Copied !!</p>
        <span class="close" title="Leave Room">&times;</span>
        <div class="sk-chase">

            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>

        </div>
        <p id="spinner-text">Wait for second user... <br>
            Room ID: <span id="room-id"></span>
            <span onclick="copyRoomId()"> <i class="far fa-copy"></i></span>
            <input type="text" id="copy">
        </p>

    </div>
    <div id="spinner-container2">
        <span class="close" title="Leave Room">&times;</span>
        <div class="sk-chase">

            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>

        </div>
        <p>Connection lost reconnecting...</p>

    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="./index.js"></script>
    <script>
        if (localStorage.getItem('roomObj') == '') {
            location.replace('index.html') //redirects when the user is not in any room
        }


        let rollResult, selectedCount, selectedRoll, selectedPiece; //global variables for DOM element
        displayOutsidePiece();

        let roomList;
        let playerRoom = JSON.parse(localStorage.getItem('roomObj'))
        var socket = io(); //initialises the socket.io object
        $(document).ready(function () {
            seedDisplay(objectRetriever());
            displayOntheMove(collateCount());
        })



        $("#room-id").text(playerRoom.id);
        $("#copy").attr('value', `${playerRoom.id}`)
        //resets game

        $("#reset").click(function (e) {
            e.preventDefault();
            let confirmation = window.confirm('Are You sure');
            if (confirmation) {
                resetAll()
            }
        })

        //recieves the room array from server
        socket.on('rooms', function (data) {
            roomList = data //assigns the room array to a global variable
            console.log(data);
        })

        $(".close").click(function () {
            $("#quit").click();
        })

        //sends the dice roll out to users in the room
        socket.on('roll', function (data) {
            clearAllSelected(); //clears previsiously selected piece
            clearSelectedRoll(); //clears previsiously selected roll results
            rollResult = rollDice(data); //gets the roll result 
            setTimeout(function () {
                displayDiceResult(rollResult); //displays the roll result
            }, 1500);

        })

        socket.on('i_just_roll', function () {
            if (rollAgain(...rollResult)) {
                socket.emit('roll_again', 'you can roll again')
            } else {
                // console.log(rollAgain(...rollResult))
                socket.emit('ok_disable_rolls', playerRoom);
                // socket.emit("you_are_nexts", playerRoom);
            }
        })


        //disables the dice rolling function
        socket.on('disableRoll', function () {
            disableRoll();
        })

        //enables the other user to be able to roll
        socket.on('your_turn', function () {
            is_your_turn();
        })

        console.log(playerRoom);

        //removes the user from a rooom 
        $("#quit").click(function () {
            // socket.rooms.leave()
            playerRoom.numberOfPlayers -= 1
            localStorage.setItem('roomObj', '');
            // socket.emit('updateRoom', playerRoom); //request the room info be changed
            socket.emit('a_user_left', playerRoom); //notifies the server a user left
            location.assign('index.html') //sends the user that left to home page
        })

        //enables the user that rolls a dice to be able to select the roll result
        socket.on("enable_roll_select", function () {
            let rolls = [...document.getElementsByClassName("rolls")];
            rolls.forEach((item) => {
                item.setAttribute("onclick", "emitSelectedRoll()");
            });
            let forfietBtn = document.getElementById("reset-count");
            forfietBtn.setAttribute("onclick", "forfietCount()");
        })

        //initializes dice rolling
        function rollsDice() {
            socket.emit('rolldice', playerRoom);
        }

        //request the server to add the user to room
        socket.emit('game', playerRoom)

        //indicates a user join
        socket.on("user", function (data) {
            console.log(` ${data.playerName} Joined ${data.name} room`)
            if (data.userJoined) { //checks if the second user has 
                $("#spinner-container").css('display', 'none'); //stops the spinner
            }
            if (playerRoom.player == "one") {
                playerRoom.playerOneConnected = true;
            } else if (playerRoom.player == "two") {
                playerRoom.playerTwoConnected = true;
            }
        })

        //stops the spinner for the second user
        socket.on('a_user_joined', function () {
            $("#spinner-container").css('display', 'none');

        })

        //disables the selected roll after counting
        socket.on("you_can_disable", function (data) {
            // console.log('hi');
            let rollresults1 = $(".rolls.one");
            let rollresults2 = $(".rolls.two");
            selectedRoll.attr("onclick", "");
            if (rollresults1.text() == "0" && rollresults2.text() == "0") {
                console.log('done counting');
                socket.emit("you_are_nexts", playerRoom);
            }
        })

        socket.on("reset_rolls", function () {
            let rolls = [...document.getElementsByClassName("rolls")];
            rolls.forEach((item) => {
                item.setAttribute("onclick", "");
                item.textContent = 0;
            });
            let forfietBtn = document.getElementById("reset-count");
            forfietBtn.setAttribute("onclick", "");
            // socket.emit("you_are_nexts", playerRoom);
        })

        socket.on("send_turn", function () {
            socket.emit("you_are_nexts", playerRoom);
        })
        //emits the counting to the room
        socket.on("counting", function () {

            countPiece();
        })

        //adds spinner when a user leaves a room
        socket.on('add_spinner', function () {
            $("#spinner-container").css('display', 'block');
        })

        //emits piece selection
        socket.on("select_the_piece", function (data) {
            selectedPiece = $(`.${data[0]}`); //selects the piece using the classnames sent from server
            let house = getPieceHouse(selectedPiece)
            // console.log(house)
            if (checkPlayer(house, playerRoom.player)) {
                // select()
                socket.emit('selection_made', data);
            } else {
                alert('You can not select, Its not ur house')
            }
            // console.log(playerRoom.player);
        })
        socket.on("emit_select", function (data) {
            selectedPiece = $(`.${data[0]}`);
            // console.log(selectedPiece);
            select()
        })
        //emits roll result selection 
        socket.on("select_the_roll", function (data) {
            selectedRoll = $(`.${data[0]}`); //selects the roll result using the classnames sent from server

            rolls();
        })

        //handles connection
        socket.on('user_is_connected', function () {
            if (playerRoom.player == "one") {
                playerRoom.playerOneConnected = true;
            } else if (playerRoom.player == "two") {
                playerRoom.playerTwoConnected = true;
            }
            if (playerRoom.playerOneConnected && playerRoom.playerTwoConnected) {
                socket.emit('all_user_connected', playerRoom)
                console.log('all user connected')
            }
            console.log('player connected');
        })
        socket.on('connection_lost', function () {
            if (playerRoom.player == "one") {
                playerRoom.playerOneConnected = false;
            } else if (playerRoom.player == "two") {
                playerRoom.playerTwoConnected = false;
            }
            $("#spinner-container2").css('display', 'block');
            console.log('user disconnected')
            // socket.emit('a_user_disconnected', playerRoom)
        })
        socket.on('on_connection', function () {
            $("#spinner-container2").css('display', 'none');
        })
        socket.on("user_disconnects", function () {
            $("#spinner-container2").css('display', 'block');
        })
    </script>
</body>

</html>